<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Compra de Boleto</title>
    <style>
        .step { display: none; }
        .step.active { display: block; }
    </style>
    <script>
        let currentStep = 0;

        // Muestra el paso actual
        function showStep(step) {
            const steps = document.querySelectorAll('.step');
            steps.forEach((el, index) => {
                el.classList.remove('active');
                if (index === step) {
                    el.classList.add('active');
                }
            });
        }

        // Verifica si todos los campos del paso actual son válidos
        function validateStep(step) {
            const stepDiv = document.querySelectorAll('.step')[step];
            const inputs = stepDiv.querySelectorAll('input, select');
            let valid = true;

            inputs.forEach(input => {
                if (!input.checkValidity()) {
                    input.classList.add('invalid');
                    valid = false;
                } else {
                    input.classList.remove('invalid');
                }
            });

            return valid;
        }

        // Ir al siguiente paso
        function nextStep() {
            if (validateStep(currentStep)) {
                currentStep++;
                showStep(currentStep);
            } else {
                alert("Por favor, completa todos los campos correctamente.");
            }
        }

        // Ir al paso anterior
        function prevStep() {
            currentStep--;
            showStep(currentStep);
        }

        document.addEventListener('DOMContentLoaded', () => {
            showStep(currentStep); // Muestra el primer paso al cargar la página
        });
    </script>
</head>
<body>

    <form id="ticketForm" action="/buyTicket" method="post">
        <!-- paso 1 destino -->
        <div class="step active">
            <p>Destino</p>
            <select id="fromLocation" name="fromLocation" required>
                <option value="" disabled selected>Seleccione un lugar de origen</option>
                <th:block th:each="destination : ${listDestinations}">
                    <option th:value="${destination.name}" th:text="${destination.name}"></option>
                </th:block>
            </select>

            <select id="toLocation" name="toLocation" required>
                <option value="" disabled selected>Seleccione un lugar de destino</option>
                <th:block th:each="destination : ${listDestinations}">
                    <option th:value="${destination.name}" th:text="${destination.name}"></option>
                </th:block>
            </select>
            <div class="step-buttons">
                <button type="button" onclick="nextStep()">Siguiente</button>
            </div>
            <span>Pronto estaremos agregando más destinos!</span>
        </div>

        <!-- paso 2 fecha -->
        <div class="step">
            <p>Fecha:</p>
            <input type="date" id="travelDate" name="travelDate" required>
            <div class="step-buttons">
                <button class="btn-back" type="button" onclick="prevStep()">Regresar</button>
                <button class="btn-next" type="button" onclick="nextStep()">Siguiente</button>
            </div>
        </div>

        <!-- paso 3 hora -->
        <div class="step">
            <p>Seleccione la hora</p>
            <div id="travelTime" name="travelTime">
                <button type="button" class="time-button" data-time="05:00">5AM</button>
                <button type="button" class="time-button" data-time="12:00">12PM</button>
                <button type="button" class="time-button" data-time="16:00">4PM</button>
            </div>
            <div class="step-buttons">
                <button type="button" onclick="prevStep()">Regresar</button>
                <button type="button" onclick="nextStep()">Siguiente</button>
            </div>
        </div>
        <input type="hidden" id="travelTimeInput" name="travelTime" required>

        <!-- paso 4 asientos -->
        <div class="step">
            <p>Asiento</p>
            <div id="seatSelection">
                <th:block th:each="seat : ${seatList}">
                    <i class="ti ti-armchair seat" th:classappend="${purchasedSeats.contains(seat) ? 'purchased' : ''}" th:data-seat="${seat}"></i>
                </th:block>
            </div>
            <input type="hidden" id="seatNumber" name="seatNumber" required>
            <div class="step-buttons">
                <button type="button" onclick="prevStep()">Regresar</button>
                <button type="button" onclick="nextStep()">Siguiente</button>
            </div>
        </div>

        <!-- paso 5 datos del pasajero -->
        <div class="step">
            <p>Datos del pasajero:</p>
            <input type="text" id="passengerName" name="passengerName" placeholder="Nombre del Pasajero:" required>

            <input pattern="\d{8}" maxlength="8" type="text" id="dni" name="dni" placeholder="Ingrese su DNI" required>
            <div class="step-buttons">
                <button type="button" onclick="prevStep()">Regresar</button>
                <button type="button" onclick="nextStep()">Siguiente</button>
            </div>
        </div>

        <!-- paso 6 pago -->
        <div class="step">
            <div class="payment">
                <label for="paymentMethod">Método de Pago:</label>
                <input type="text" id="cardnumber" name="cardnumber" pattern="\d{16}" maxlength="16" placeholder="Número de tarjeta:" required>
                <input type="text" id="cvv" name="cvv" pattern="\d{3}" maxlength="3" placeholder="CVV" required>
                <input type="text" id="expiry" name="expiry" pattern="\d{2}/\d{2}" maxlength="5" placeholder="MM/AA" required>
            </div>
            <div class="step-buttons">
                <button type="button" onclick="prevStep()">Regresar</button>
                <button type="submit">Comprar Boleto</button>
            </div>
        </div>
    </form>

</body>
</html>
